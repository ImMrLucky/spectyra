<div class="card">
  <h3>Debug Info</h3>
  <div class="debug-content">
    <div *ngIf="run.debug.refsUsed && run.debug.refsUsed.length > 0">
      <strong>REFs Used:</strong>
      <ul>
        <li *ngFor="let ref of run.debug.refsUsed">{{ ref }}</li>
      </ul>
    </div>
    
    <div class="debug-flags">
      <span class="badge" *ngIf="run.debug.deltaUsed">Delta Prompting</span>
      <span class="badge" *ngIf="run.debug.codeSliced">Code Sliced</span>
      <span class="badge" *ngIf="run.debug.patchMode">Patch Mode</span>
    </div>
    
    <div *ngIf="run.debug.spectral" class="spectral-info">
      <h4>Spectral Analysis</h4>
      <table class="table">
        <tr>
          <td>Nodes</td>
          <td>{{ run.debug.spectral.nNodes }}</td>
        </tr>
        <tr>
          <td>Edges</td>
          <td>{{ run.debug.spectral.nEdges }}</td>
        </tr>
        <tr>
          <td>Stability Index</td>
          <td><strong>{{ run.debug.spectral.stabilityIndex.toFixed(3) }}</strong></td>
        </tr>
        <tr *ngIf="run.debug.spectral.lambda2 !== undefined">
          <td>λ₂ (Spectral Gap)</td>
          <td>{{ run.debug.spectral.lambda2.toFixed(4) }}</td>
        </tr>
        <tr *ngIf="run.debug.spectral.contradictionEnergy !== undefined">
          <td>Contradiction Energy</td>
          <td>{{ run.debug.spectral.contradictionEnergy.toFixed(4) }}</td>
        </tr>
        <tr>
          <td>Recommendation</td>
          <td><strong>{{ run.debug.spectral.recommendation }}</strong></td>
        </tr>
        <tr *ngIf="run.debug.retry">
          <td>Retry</td>
          <td><span class="badge badge-warning">Yes (relaxed policy)</span></td>
        </tr>
        <tr *ngIf="run.debug.retry_reason">
          <td>Retry Reason</td>
          <td>{{ run.debug.retry_reason }}</td>
        </tr>
        <tr>
          <td>Stable Units</td>
          <td>{{ run.debug.spectral.stableUnitIds.length }}</td>
        </tr>
        <tr>
          <td>Unstable Units</td>
          <td>{{ run.debug.spectral.unstableUnitIds.length }}</td>
        </tr>
      </table>
    </div>
    
    <div *ngIf="run.quality" class="quality-info">
      <h4>Quality Check</h4>
      <table class="table">
        <tr>
          <td>Status</td>
          <td>
            <span class="badge" [class.badge-success]="run.quality.pass" [class.badge-danger]="!run.quality.pass">
              {{ run.quality.pass ? 'PASS' : 'FAIL' }}
            </span>
          </td>
        </tr>
        <tr *ngIf="!run.quality.pass && run.quality.failures && run.quality.failures.length > 0">
          <td>Failures</td>
          <td>
            <ul>
              <li *ngFor="let failure of run.quality.failures">{{ failure }}</li>
            </ul>
          </td>
        </tr>
      </table>
    </div>
  </div>
</div>
